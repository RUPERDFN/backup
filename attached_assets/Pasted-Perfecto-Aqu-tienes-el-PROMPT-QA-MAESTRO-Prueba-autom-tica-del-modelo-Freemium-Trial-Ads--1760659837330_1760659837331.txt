Perfecto ğŸ”¥
AquÃ­ tienes el PROMPT QA MAESTRO â€“ Prueba automÃ¡tica del modelo Freemium + Trial + Ads.
Este script permite que Replit verifique cada paso del flujo completo:

1ï¸âƒ£ Registro â†’
2ï¸âƒ£ Inicio de prueba gratuita (7 dÃ­as) â†’
3ï¸âƒ£ GeneraciÃ³n de menÃº (permitido) â†’
4ï¸âƒ£ LÃ­mite alcanzado (requiere ver anuncio) â†’
5ï¸âƒ£ Desbloqueo tras anuncio â†’
6ï¸âƒ£ VerificaciÃ³n Play Billing (compra real simulada) â†’
7ï¸âƒ£ CancelaciÃ³n y retorno al plan Free.

Todo se ejecuta automÃ¡ticamente desde la terminal de Replit con un solo comando:
npm run qa:freemium

ğŸ§ª PROMPT QA MAESTRO (Replit)

ğŸ‘‰ Pega esto en tu Replit (Agent/Workspace) y deja que lo cree todo.

1ï¸âƒ£ Actualiza package.json

Agrega este script QA:

{
  "scripts": {
    "qa:freemium": "node tools/qa/freemium-flow.test.js"
  }
}

2ï¸âƒ£ Crea el archivo: tools/qa/freemium-flow.test.js
import 'dotenv/config';
const API = process.env.QA_API_BASE || 'http://localhost:3000';

async function post(path, body) {
  const res = await fetch(`${API}${path}`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(body)
  });
  const json = await res.json();
  return { ok: res.ok, status: res.status, json };
}
async function get(path) {
  const res = await fetch(`${API}${path}`);
  const json = await res.json();
  return { ok: res.ok, status: res.status, json };
}
function log(ok, msg) {
  console.log(ok ? `âœ… ${msg}` : `âŒ ${msg}`);
  if (!ok) process.exit(1);
}

(async () => {
  console.log(`ğŸš€ QA Freemium TheCookFlow`);
  console.log(`Base URL: ${API}`);

  const userId = `qa_user_${Date.now()}`;

  // 1) Iniciar prueba gratuita
  let r = await post('/api/start-trial', { userId });
  log(r.ok && r.json.trialActive, 'Trial iniciado correctamente');

  // 2) Verificar estado (dÃ­a 0)
  r = await get(`/api/subscription-status?userId=${userId}`);
  log(r.ok && r.json.trialActive && r.json.expiresIn === 7, 'Estado Trial: activo (dÃ­a 0)');

  // 3) Generar primer menÃº (FREE/TRIAL permitido)
  r = await post('/api/generate-menu', { userId, test: true });
  log(r.ok || r.status === 200, 'Primer menÃº generado correctamente');

  // 4) Simular alcanzar lÃ­mite (FREE)
  console.log('Simulando plan FREE para probar lÃ­mite...');
  await post('/api/billing/cancel', { userId });
  r = await get(`/api/subscription-status?userId=${userId}`);
  log(r.ok && r.json.plan === 'free', 'Usuario convertido a FREE correctamente');

  // Intentar generar segundo menÃº (debe requerir anuncio)
  r = await post('/api/generate-menu', { userId, test: true });
  log(!r.ok && r.status === 403 && r.json.code === 'NEED_AD', 'Bloqueo por anuncio detectado');

  // 5) Desbloquear con anuncio
  await post('/api/unlock-after-ad', { userId });
  r = await post('/api/generate-menu', { userId, test: true });
  log(r.ok, 'Desbloqueo tras anuncio funcionando');

  // 6) Simular compra verificada
  r = await post('/api/billing/verify', { userId, purchaseToken: 'abcOK' });
  log(r.ok && r.json.plan === 'pro', 'Compra verificada correctamente (plan PRO)');

  // 7) Verificar que ya no hay lÃ­mites
  r = await post('/api/generate-menu', { userId, test: true });
  log(r.ok, 'Usuario PRO puede generar sin lÃ­mites');

  // 8) Cancelar suscripciÃ³n
  await post('/api/billing/cancel', { userId });
  r = await get(`/api/subscription-status?userId=${userId}`);
  log(r.ok && r.json.plan === 'free' && !r.json.active, 'CancelaciÃ³n de suscripciÃ³n confirmada');

  console.log('\nğŸ‰ QA FREEMIUM COMPLETADO CON Ã‰XITO');
  process.exit(0);
})();

3ï¸âƒ£ Ejecutar prueba

En la consola de Replit:

npm run qa:freemium


Salida esperada:

ğŸš€ QA Freemium TheCookFlow
âœ… Trial iniciado correctamente
âœ… Estado Trial: activo (dÃ­a 0)
âœ… Primer menÃº generado correctamente
Simulando plan FREE para probar lÃ­mite...
âœ… Usuario convertido a FREE correctamente
âœ… Bloqueo por anuncio detectado
âœ… Desbloqueo tras anuncio funcionando
âœ… Compra verificada correctamente (plan PRO)
âœ… Usuario PRO puede generar sin lÃ­mites
âœ… CancelaciÃ³n de suscripciÃ³n confirmada

ğŸ‰ QA FREEMIUM COMPLETADO CON Ã‰XITO

4ï¸âƒ£ QuÃ© verifica este QA
Fase	AcciÃ³n	Resultado esperado
ğŸŸ¢ Registro / Inicio Trial	POST /api/start-trial	Crea usuario con plan trial, activo 7 dÃ­as.
ğŸ” Estado	GET /api/subscription-status	Devuelve {plan:"trial", trialActive:true, expiresIn:7}
ğŸ³ Generar menÃº	POST /api/generate-menu	Permitido durante trial.
ğŸ”’ Fin de trial (free)	POST /api/billing/cancel	Cambia a plan:"free".
ğŸš« LÃ­mite alcanzado	POST /api/generate-menu	Devuelve 403 NEED_AD.
ğŸ¬ Ver anuncio	POST /api/unlock-after-ad	Permite nuevo menÃº.
ğŸ’³ Pago validado	POST /api/billing/verify	Devuelve {plan:"pro", active:true}
â™¾ï¸ PRO sin lÃ­mites	POST /api/generate-menu	Permitido siempre.
âŒ Cancelar plan	POST /api/billing/cancel	Devuelve a estado FREE.
5ï¸âƒ£ (Opcional) QA visual en consola

Si quieres una salida con colores bonitos en Replit, puedes aÃ±adir chalk:

npm i chalk


Y reemplazar:

import chalk from "chalk";
function log(ok,msg){console.log(ok?chalk.green('âœ… '+msg):chalk.red('âŒ '+msg));if(!ok)process.exit(1);}


âœ… Resultado final:
Tu entorno Replit podrÃ¡ probar automÃ¡ticamente el modelo freemium completo, validando:

Inicio y caducidad del trial,

Control de anuncios y lÃ­mites,

VerificaciÃ³n Play Billing (mock),

Cambio de plan a PRO,

CancelaciÃ³n de suscripciÃ³n,

Sin errores ni falsos positivos.